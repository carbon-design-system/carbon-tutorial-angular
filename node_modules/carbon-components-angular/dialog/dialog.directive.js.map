{"version":3,"file":"dialog.directive.js","sourceRoot":"","sources":["../src/dialog/dialog.directive.ts"],"names":[],"mappings":"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","sourcesContent":["import {\n\tDirective,\n\tInput,\n\tOutput,\n\tEventEmitter,\n\tOnInit,\n\tOnDestroy,\n\tElementRef,\n\tTemplateRef,\n\tViewContainerRef,\n\tHostListener,\n\tOnChanges,\n\tHostBinding\n} from \"@angular/core\";\nimport { fromEvent } from \"rxjs\";\nimport { DialogService } from \"./dialog.service\";\nimport { DialogConfig } from \"./dialog-config.interface\";\n\n/**\n * A generic directive that can be inherited from to create dialogs (for example, a tooltip or popover)\n *\n * This class contains the relevant initialization code, specific templates, options, and additional inputs\n * should be specified in the derived class.\n *\n * NOTE: All child classes should add `DialogService` as a provider, otherwise they will lose context that\n * the service relies on.\n */\n@Directive({\n\tselector: \"[ibmDialog]\",\n\texportAs: \"ibmDialog\",\n\tproviders: [\n\t\tDialogService\n\t]\n})\nexport class DialogDirective implements OnInit, OnDestroy, OnChanges {\n\tstatic dialogCounter = 0;\n\t/**\n\t * Title for the dialog\n\t */\n\t@Input() title = \"\";\n\t/**\n\t * Dialog body content.\n\t */\n\t@Input() ibmDialog: string | TemplateRef<any>;\n\t/**\n\t * Defines how the Dialog is triggered.(Hover and click behave the same on mobile - both respond to a single tap)\n\t */\n\t@Input() trigger: \"click\" | \"hover\" | \"mouseenter\" = \"click\";\n\t/**\n\t * Defines how the Dialog close event is triggered.\n\t *\n\t * [See here](https://developer.mozilla.org/en-US/docs/Web/API/Element/mouseleave_event)\n\t * for more on the difference between `mouseleave` and `mouseout`.\n\t *\n\t * Defaults to `click` when `trigger` is set to `click`.\n\t */\n\t@Input() closeTrigger: \"mouseout\" | \"mouseleave\" = \"mouseleave\";\n\t/**\n\t * Placement of the dialog, usually relative to the element the directive is on.\n\t */\n\t@Input() placement = \"left\";\n\t/**\n\t * Class to add to the dialog container\n\t */\n\t@Input() wrapperClass: string;\n\t/**\n\t * Spacing between the dialog and it's triggering element\n\t */\n\t@Input() gap = 0;\n\t/**\n\t * Deprecated. Defaults to true. Use appendInline to keep dialogs within page flow\n\t * Value `true` appends Dialog to the body (to break out of containers)\n\t */\n\t@Input() set appendToBody(v: boolean) {\n\t\tconsole.log(\"`appendToBody` has been deprecated. Dialogs now append to the body by default.\");\n\t\tconsole.log(\"Ensure you have an `ibm-placeholder` in your app.\");\n\t\tconsole.log(\"Use `appendInline` if you need to position your dialogs within the normal page flow.\");\n\t\tthis.appendInline = !v;\n\t}\n\tget appendToBody() {\n\t\treturn !this.appendInline;\n\t}\n\t/**\n\t * Set to `true` to open the dialog next to the triggering component\n\t */\n\t@Input() appendInline = false;\n\t/**\n\t * Optional data for templates\n\t */\n\t@Input() data = {};\n\t/**\n\t * Config object passed to the rendered component\n\t */\n\tdialogConfig: DialogConfig;\n\t/**\n\t * Emits an event when the dialog is closed\n\t */\n\t@Output() onClose: EventEmitter<any> = new EventEmitter();\n\t/**\n\t * Emits an event when the dialog is opened\n\t */\n\t@Output() onOpen: EventEmitter<any> = new EventEmitter();\n\n\t@HostBinding(\"attr.role\") role = \"button\";\n\t@HostBinding(\"attr.aria-expanded\") expanded = false;\n\t@HostBinding(\"attr.aria-haspopup\") hasPopup = true;\n\t@HostBinding(\"attr.aria-owns\") get ariaOwns(): string {\n\t\treturn this.expanded ? this.dialogConfig.compID : null;\n\t}\n\n\t/**\n\t * Creates an instance of DialogDirective.\n\t * @param elementRef\n\t * @param viewContainerRef\n\t * @param dialogService\n\t */\n\tconstructor(\n\t\tprotected elementRef: ElementRef,\n\t\tprotected viewContainerRef: ViewContainerRef,\n\t\tprotected dialogService: DialogService) {}\n\n\t/**\n\t * Overrides 'touchstart' event to trigger a toggle on the Dialog.\n\t */\n\t@HostListener(\"touchstart\", [\"$event\"])\n\tonTouchStart(evt) {\n\t\tevt.stopImmediatePropagation();\n\t\tevt.preventDefault();\n\t\tthis.toggle();\n\t}\n\n\tngOnChanges() {\n\t\t// set the config object (this can [and should!] be added to in child classes depending on what they need)\n\t\tthis.dialogConfig = {\n\t\t\ttitle: this.title,\n\t\t\tcontent: this.ibmDialog,\n\t\t\tplacement: this.placement,\n\t\t\tparentRef: this.elementRef,\n\t\t\tgap: this.gap,\n\t\t\ttrigger: this.trigger,\n\t\t\tcloseTrigger: this.closeTrigger,\n\t\t\tshouldClose: () => true,\n\t\t\tappendInline: this.appendInline,\n\t\t\twrapperClass: this.wrapperClass,\n\t\t\tdata: this.data\n\t\t};\n\t}\n\n\t/**\n\t * Sets the config object and binds events for hovering or clicking before\n\t * running code from child class.\n\t */\n\tngOnInit() {\n\t\t// fix for safari hijacking clicks\n\t\tthis.dialogService.singletonClickListen();\n\n\t\tfromEvent(this.elementRef.nativeElement, \"keydown\").subscribe((event: KeyboardEvent) => {\n\t\t\t// \"Esc\" is an IE specific value\n\t\t\tif (event.target === this.dialogConfig.parentRef.nativeElement && (event.key === \"Tab\" || event.key === \"Tab\" && event.shiftKey) ||\n\t\t\t\tevent.key === \"Escape\" || event.key === \"Esc\") {\n\t\t\t\tthis.close();\n\t\t\t}\n\t\t});\n\n\t\t// bind events for hovering or clicking the host\n\t\tif (this.trigger === \"hover\" || this.trigger === \"mouseenter\") {\n\t\t\tfromEvent(this.elementRef.nativeElement, \"mouseenter\").subscribe(() => this.toggle());\n\t\t\tfromEvent(this.elementRef.nativeElement, this.closeTrigger).subscribe(() => this.close());\n\t\t\tfromEvent(this.elementRef.nativeElement, \"focus\").subscribe(() => this.open());\n\t\t\tfromEvent(this.elementRef.nativeElement, \"blur\").subscribe(() => this.close());\n\t\t} else {\n\t\t\tfromEvent(this.elementRef.nativeElement, \"click\").subscribe(() => this.toggle());\n\t\t\tfromEvent(this.elementRef.nativeElement, \"keydown\").subscribe((event: KeyboardEvent) => {\n\t\t\t\t// \"Spacebar\" is an IE specific value\n\t\t\t\tif (event.key === \"Enter\" || event.key === \" \" || event.key === \"Spacebar\") {\n\t\t\t\t\tthis.open();\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\t// call onClose when the dialog is closed\n\t\t// - Enforce accessibility by updating an aria attr for nativeElement.\n\t\tthis.dialogService.isClosed.subscribe(value => {\n\t\t\tif (value) {\n\t\t\t\tthis.onClose.emit();\n\t\t\t\tthis.expanded = false;\n\t\t\t}\n\t\t});\n\n\t\tDialogDirective.dialogCounter++;\n\t\tthis.dialogConfig.compID = \"dialog-\" + DialogDirective.dialogCounter;\n\n\t\t// run any code a child class may need\n\t\tthis.onDialogInit();\n\t}\n\n\t/**\n\t * When the host dies, kill the popover.\n\t * - Useful for use in a modal or similar.\n\t */\n\tngOnDestroy() {\n\t\tthis.close();\n\t}\n\n\t/**\n\t * Helper method to call dialogService 'open'.\n\t * - Enforce accessibility by updating an aria attr for nativeElement.\n\t */\n\topen() {\n\t\tthis.dialogService.open(this.viewContainerRef, this.dialogConfig);\n\t\tthis.expanded = true;\n\t\tthis.onOpen.emit();\n\t}\n\n\t/**\n\t * Helper method to call dialogService 'toggle'.\n\t * - Enforce accessibility by updating an aria attr for nativeElement.\n\t */\n\ttoggle() {\n\t\tthis.dialogService.toggle(this.viewContainerRef, this.dialogConfig);\n\t\tthis.expanded = this.dialogService.isOpen;\n\t\tif (this.expanded) {\n\t\t\tthis.onOpen.emit();\n\t\t}\n\t}\n\n\t/**\n\t * Helper method to call dialogService 'close'.\n\t * - Enforce accessibility by updating an aria attr for nativeElement.\n\t */\n\tclose() {\n\t\tthis.dialogService.close(this.viewContainerRef);\n\t\tthis.expanded = false;\n\t}\n\n\t/**\n\t * Empty method for child classes to override and specify additional init steps.\n\t * Run after DialogDirective completes it's ngOnInit.\n\t */\n\tprotected onDialogInit() {}\n}\n"]}