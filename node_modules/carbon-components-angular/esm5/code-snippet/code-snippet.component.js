/**
 *
 * carbon-angular v0.0.0 | code-snippet.component.js
 *
 * Copyright 2014, 2021 IBM
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0

 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */


import { Component, Input, HostBinding, ViewChild, HostListener } from "@angular/core";
import { I18n } from "carbon-components-angular/i18n";
export var SnippetType;
(function (SnippetType) {
    SnippetType["single"] = "single";
    SnippetType["multi"] = "multi";
    SnippetType["inline"] = "inline";
})(SnippetType || (SnippetType = {}));
/**
 * [See demo](../../?path=/story/components-code-snippet--basic)
 *
 * ```html
 * <ibm-code-snippet>Code</ibm-code-snippet>
 * ```
 *
 * <example-url>../../iframe.html?id=components-code-snippet--basic</example-url>
 */
var CodeSnippet = /** @class */ (function () {
    /**
     * Creates an instance of CodeSnippet.
     */
    function CodeSnippet(i18n) {
        this.i18n = i18n;
        /**
         * It can be `"single"`, `"multi"` or `"inline"`
         *
         */
        this.display = SnippetType.single;
        this.translations = this.i18n.get().CODE_SNIPPET;
        /**
         * Set to `"light"` to apply the light style on the code snippet.
         */
        this.theme = "dark";
        /**
         * Text displayed in the tooltip when user clicks button to copy code.
         *
         */
        this.feedbackText = this.translations.COPIED;
        /**
         * Time in miliseconds to keep the feedback tooltip displayed.
         *
         */
        this.feedbackTimeout = 2000;
        this.expanded = false;
        this.skeleton = false;
        this.snippetClass = true;
        this.showFeedback = false;
        this.hasExpandButton = null;
        CodeSnippet.codeSnippetCount++;
    }
    Object.defineProperty(CodeSnippet.prototype, "snippetSingleClass", {
        get: function () {
            return this.display === SnippetType.single;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(CodeSnippet.prototype, "snippetMultiClass", {
        get: function () {
            return this.display === SnippetType.multi;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(CodeSnippet.prototype, "snippetInlineClass", {
        get: function () {
            return this.display === SnippetType.inline;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(CodeSnippet.prototype, "snippetInlineLightClass", {
        get: function () {
            return this.display === SnippetType.inline && this.theme === "light";
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(CodeSnippet.prototype, "btnCopyClass", {
        get: function () {
            return this.display === SnippetType.inline;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(CodeSnippet.prototype, "displayStyle", {
        get: function () {
            return this.display !== SnippetType.inline ? "block" : null;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(CodeSnippet.prototype, "attrType", {
        get: function () {
            return this.display === SnippetType.inline ? "button" : null;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(CodeSnippet.prototype, "shouldShowExpandButton", {
        get: function () {
            // Checks if `hasExpand` button has been initialized in `AfterViewInit` before detecting whether or not to
            // show the expand button when the code displayed in the component changes during the life of the component.
            // This is to avoid the `ExpressionChangedAfterItHasBeenCheckedError`.
            if (this.hasExpandButton === null) {
                return this.hasExpandButton;
            }
            return this.canExpand();
        },
        enumerable: true,
        configurable: true
    });
    CodeSnippet.prototype.toggleSnippetExpansion = function () {
        this.expanded = !this.expanded;
    };
    /**
     * Copies the code from the `<code>` block to clipboard.
     *
     */
    CodeSnippet.prototype.copyCode = function () {
        // create invisible, uneditable textarea with our code in it
        var textarea = document.createElement("textarea");
        textarea.value = this.code.nativeElement.innerText || this.code.nativeElement.textContent;
        textarea.setAttribute("readonly", "");
        textarea.style.position = "absolute";
        textarea.style.right = "-99999px";
        document.body.appendChild(textarea);
        // save user selection
        var selected = document.getSelection().rangeCount ? document.getSelection().getRangeAt(0) : null;
        // copy to clipboard
        textarea.select();
        document.execCommand("copy");
        // remove textarea
        document.body.removeChild(textarea);
        // restore user selection
        if (selected) {
            document.getSelection().removeAllRanges();
            document.getSelection().addRange(selected);
        }
    };
    CodeSnippet.prototype.onCopyButtonClicked = function () {
        var _this = this;
        this.copyCode();
        this.showFeedback = true;
        setTimeout(function () {
            _this.showFeedback = false;
        }, this.feedbackTimeout);
    };
    CodeSnippet.prototype.ngAfterViewInit = function () {
        var _this = this;
        setTimeout(function () {
            if (_this.canExpand()) {
                _this.hasExpandButton = true;
            }
            else {
                _this.hasExpandButton = false;
            }
        });
    };
    /**
     * Inline code snippet acts as button and makes the whole component clickable.
     *
     * This handles clicks in that case.
     */
    CodeSnippet.prototype.hostClick = function () {
        if (this.display !== SnippetType.inline) {
            return;
        }
        this.onCopyButtonClicked();
    };
    CodeSnippet.prototype.canExpand = function () {
        return (this.code && this.code.nativeElement.getBoundingClientRect().height > 255) && this.display === "multi";
    };
    /**
     * Variable used for creating unique ids for code-snippet components.
     */
    CodeSnippet.codeSnippetCount = 0;
    CodeSnippet.decorators = [
        { type: Component, args: [{
                    selector: "ibm-code-snippet",
                    template: "\n\t\t<ng-container *ngIf=\"display === 'inline'; else notInline\">\n\t\t\t<ng-container *ngTemplateOutlet=\"codeTemplate\"></ng-container>\n\t\t\t<ng-container *ngTemplateOutlet=\"feedbackTemplate\"></ng-container>\n\t\t</ng-container>\n\n\t\t<ng-template #notInline>\n\t\t\t<div class=\"bx--snippet-container\" [attr.aria-label]=\"translations.CODE_SNIPPET_TEXT\">\n\t\t\t\t<ng-container *ngIf=\"skeleton\">\n\t\t\t\t\t<span *ngIf=\"display === 'single'; else multiSkeleton\"></span>\n\t\t\t\t\t<ng-template #multiSkeleton>\n\t\t\t\t\t\t<span></span>\n\t\t\t\t\t\t<span></span>\n\t\t\t\t\t\t<span></span>\n\t\t\t\t\t</ng-template>\n\t\t\t\t</ng-container>\n\t\t\t\t<pre *ngIf=\"!skeleton\"><ng-container *ngTemplateOutlet=\"codeTemplate\"></ng-container></pre>\n\t\t\t</div>\n\t\t\t<button\n\t\t\t\t*ngIf=\"!skeleton\"\n\t\t\t\tclass=\"bx--snippet-button\"\n\t\t\t\t[attr.aria-label]=\"translations.COPY_CODE\"\n\t\t\t\t(click)=\"onCopyButtonClicked()\"\n\t\t\t\ttabindex=\"0\">\n\t\t\t\t<svg ibmIcon=\"copy\" size=\"16\" class=\"bx--snippet__icon\"></svg>\n\t\t\t\t<ng-container *ngTemplateOutlet=\"feedbackTemplate\"></ng-container>\n\t\t\t</button>\n\t\t\t<button\n\t\t\t\t*ngIf=\"shouldShowExpandButton\"\n\t\t\t\tclass=\"bx--btn bx--btn--ghost bx--btn--sm bx--snippet-btn--expand\"\n\t\t\t\t(click)=\"toggleSnippetExpansion()\"\n\t\t\t\ttype=\"button\">\n\t\t\t\t<span class=\"bx--snippet-btn--text\">{{expanded ? translations.SHOW_LESS : translations.SHOW_MORE}}</span>\n\t\t\t\t<svg ibmIcon=\"chevron--down\" size=\"16\" class=\"bx--icon-chevron--down\" [ariaLabel]=\"translations.SHOW_MORE_ICON\"></svg>\n\t\t\t</button>\n\t\t</ng-template>\n\n\t\t<ng-template #codeTemplate>\n\t\t\t<code #code><ng-content></ng-content></code>\n\t\t</ng-template>\n\n\t\t<ng-template #feedbackTemplate>\n\t\t\t<div\n\t\t\tclass=\"bx--btn--copy__feedback\"\n\t\t\t[ngClass]=\"{\n\t\t\t\t'bx--btn--copy__feedback--displayed': showFeedback\n\t\t\t}\"\n\t\t\t[attr.data-feedback]=\"feedbackText\">\n\t\t\t</div>\n\t\t</ng-template>\n\t"
                }] }
    ];
    /** @nocollapse */
    CodeSnippet.ctorParameters = function () { return [
        { type: I18n }
    ]; };
    CodeSnippet.propDecorators = {
        display: [{ type: Input }],
        translations: [{ type: Input }],
        theme: [{ type: Input }],
        feedbackText: [{ type: Input }],
        feedbackTimeout: [{ type: Input }],
        expanded: [{ type: HostBinding, args: ["class.bx--snippet--expand",] }, { type: Input }],
        skeleton: [{ type: HostBinding, args: ["class.bx--skeleton",] }, { type: Input }],
        snippetClass: [{ type: HostBinding, args: ["class.bx--snippet",] }],
        snippetSingleClass: [{ type: HostBinding, args: ["class.bx--snippet--single",] }],
        snippetMultiClass: [{ type: HostBinding, args: ["class.bx--snippet--multi",] }],
        snippetInlineClass: [{ type: HostBinding, args: ["class.bx--snippet--inline",] }],
        snippetInlineLightClass: [{ type: HostBinding, args: ["class.bx--snippet--light",] }],
        btnCopyClass: [{ type: HostBinding, args: ["class.bx--btn--copy",] }],
        displayStyle: [{ type: HostBinding, args: ["style.display",] }],
        attrType: [{ type: HostBinding, args: ["attr.type",] }],
        code: [{ type: ViewChild, args: ["code", { static: false },] }],
        hostClick: [{ type: HostListener, args: ["click",] }]
    };
    return CodeSnippet;
}());
export { CodeSnippet };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29kZS1zbmlwcGV0LmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL2NhcmJvbi1jb21wb25lbnRzLWFuZ3VsYXIvY29kZS1zbmlwcGV0LyIsInNvdXJjZXMiOlsiY29kZS1zbmlwcGV0LmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQ04sU0FBUyxFQUNULEtBQUssRUFDTCxXQUFXLEVBQ1gsU0FBUyxFQUNULFlBQVksRUFFWixNQUFNLGVBQWUsQ0FBQztBQUV2QixPQUFPLEVBQUUsSUFBSSxFQUFFLE1BQU0sZ0NBQWdDLENBQUM7QUFFdEQsTUFBTSxDQUFOLElBQVksV0FJWDtBQUpELFdBQVksV0FBVztJQUN0QixnQ0FBaUIsQ0FBQTtJQUNqQiw4QkFBZSxDQUFBO0lBQ2YsZ0NBQWlCLENBQUE7QUFDbEIsQ0FBQyxFQUpXLFdBQVcsS0FBWCxXQUFXLFFBSXRCO0FBRUQ7Ozs7Ozs7O0dBUUc7QUFDSDtJQWdJQzs7T0FFRztJQUNILHFCQUFzQixJQUFVO1FBQVYsU0FBSSxHQUFKLElBQUksQ0FBTTtRQXZFaEM7OztXQUdHO1FBQ00sWUFBTyxHQUFnQixXQUFXLENBQUMsTUFBTSxDQUFDO1FBQzFDLGlCQUFZLEdBQUcsSUFBSSxDQUFDLElBQUksQ0FBQyxHQUFHLEVBQUUsQ0FBQyxZQUFZLENBQUM7UUFFckQ7O1dBRUc7UUFDTSxVQUFLLEdBQXFCLE1BQU0sQ0FBQztRQUUxQzs7O1dBR0c7UUFDTSxpQkFBWSxHQUFHLElBQUksQ0FBQyxZQUFZLENBQUMsTUFBTSxDQUFDO1FBRWpEOzs7V0FHRztRQUNNLG9CQUFlLEdBQUcsSUFBSSxDQUFDO1FBRW1CLGFBQVEsR0FBRyxLQUFLLENBQUM7UUFDeEIsYUFBUSxHQUFHLEtBQUssQ0FBQztRQUUzQixpQkFBWSxHQUFHLElBQUksQ0FBQztRQXFDdEQsaUJBQVksR0FBRyxLQUFLLENBQUM7UUFFckIsb0JBQWUsR0FBRyxJQUFJLENBQUM7UUFNdEIsV0FBVyxDQUFDLGdC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MitEQWtEVDtpQkFDRDs7OztnQkF0RVEsSUFBSTs7OzBCQWlGWCxLQUFLOytCQUNMLEtBQUs7d0JBS0wsS0FBSzsrQkFNTCxLQUFLO2tDQU1MLEtBQUs7MkJBRUwsV0FBVyxTQUFDLDJCQUEyQixjQUFHLEtBQUs7MkJBQy9DLFdBQVcsU0FBQyxvQkFBb0IsY0FBRyxLQUFLOytCQUV4QyxXQUFXLFNBQUMsbUJBQW1CO3FDQUMvQixXQUFXLFNBQUMsMkJBQTJCO29DQUd2QyxXQUFXLFNBQUMsMEJBQTBCO3FDQUd0QyxXQUFXLFNBQUMsMkJBQTJCOzBDQUd2QyxXQUFXLFNBQUMsMEJBQTBCOytCQUd0QyxXQUFXLFNBQUMscUJBQXFCOytCQUlqQyxXQUFXLFNBQUMsZUFBZTsyQkFHM0IsV0FBVyxTQUFDLFdBQVc7dUJBS3ZCLFNBQVMsU0FBQyxNQUFNLEVBQUUsRUFBRSxNQUFNLEVBQUUsS0FBSyxFQUFFOzRCQWtGbkMsWUFBWSxTQUFDLE9BQU87O0lBWXRCLGtCQUFDO0NBQUEsQUE5TUQsSUE4TUM7U0F4SlksV0FBVyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7XG5cdENvbXBvbmVudCxcblx0SW5wdXQsXG5cdEhvc3RCaW5kaW5nLFxuXHRWaWV3Q2hpbGQsXG5cdEhvc3RMaXN0ZW5lcixcblx0QWZ0ZXJWaWV3SW5pdFxufSBmcm9tIFwiQGFuZ3VsYXIvY29yZVwiO1xuXG5pbXBvcnQgeyBJMThuIH0gZnJvbSBcImNhcmJvbi1jb21wb25lbnRzLWFuZ3VsYXIvaTE4blwiO1xuXG5leHBvcnQgZW51bSBTbmlwcGV0VHlwZSB7XG5cdHNpbmdsZSA9IFwic2luZ2xlXCIsXG5cdG11bHRpID0gXCJtdWx0aVwiLFxuXHRpbmxpbmUgPSBcImlubGluZVwiXG59XG5cbi8qKlxuICogW1NlZSBkZW1vXSguLi8uLi8/cGF0aD0vc3RvcnkvY29tcG9uZW50cy1jb2RlLXNuaXBwZXQtLWJhc2ljKVxuICpcbiAqIGBgYGh0bWxcbiAqIDxpYm0tY29kZS1zbmlwcGV0PkNvZGU8L2libS1jb2RlLXNuaXBwZXQ+XG4gKiBgYGBcbiAqXG4gKiA8ZXhhbXBsZS11cmw+Li4vLi4vaWZyYW1lLmh0bWw/aWQ9Y29tcG9uZW50cy1jb2RlLXNuaXBwZXQtLWJhc2ljPC9leGFtcGxlLXVybD5cbiAqL1xuQENvbXBvbmVudCh7XG5cdHNlbGVjdG9yOiBcImlibS1jb2RlLXNuaXBwZXRcIixcblx0dGVtcGxhdGU6IGBcblx0XHQ8bmctY29udGFpbmVyICpuZ0lmPVwiZGlzcGxheSA9PT0gJ2lubGluZSc7IGVsc2Ugbm90SW5saW5lXCI+XG5cdFx0XHQ8bmctY29udGFpbmVyICpuZ1RlbXBsYXRlT3V0bGV0PVwiY29kZVRlbXBsYXRlXCI+PC9uZy1jb250YWluZXI+XG5cdFx0XHQ8bmctY29udGFpbmVyICpuZ1RlbXBsYXRlT3V0bGV0PVwiZmVlZGJhY2tUZW1wbGF0ZVwiPjwvbmctY29udGFpbmVyPlxuXHRcdDwvbmctY29udGFpbmVyPlxuXG5cdFx0PG5nLXRlbXBsYXRlICNub3RJbmxpbmU+XG5cdFx0XHQ8ZGl2IGNsYXNzPVwiYngtLXNuaXBwZXQtY29udGFpbmVyXCIgW2F0dHIuYXJpYS1sYWJlbF09XCJ0cmFuc2xhdGlvbnMuQ09ERV9TTklQUEVUX1RFWFRcIj5cblx0XHRcdFx0PG5nLWNvbnRhaW5lciAqbmdJZj1cInNrZWxldG9uXCI+XG5cdFx0XHRcdFx0PHNwYW4gKm5nSWY9XCJkaXNwbGF5ID09PSAnc2luZ2xlJzsgZWxzZSBtdWx0aVNrZWxldG9uXCI+PC9zcGFuPlxuXHRcdFx0XHRcdDxuZy10ZW1wbGF0ZSAjbXVsdGlTa2VsZXRvbj5cblx0XHRcdFx0XHRcdDxzcGFuPjwvc3Bhbj5cblx0XHRcdFx0XHRcdDxzcGFuPjwvc3Bhbj5cblx0XHRcdFx0XHRcdDxzcGFuPjwvc3Bhbj5cblx0XHRcdFx0XHQ8L25nLXRlbXBsYXRlPlxuXHRcdFx0XHQ8L25nLWNvbnRhaW5lcj5cblx0XHRcdFx0PHByZSAqbmdJZj1cIiFza2VsZXRvblwiPjxuZy1jb250YWluZXIgKm5nVGVtcGxhdGVPdXRsZXQ9XCJjb2RlVGVtcGxhdGVcIj48L25nLWNvbnRhaW5lcj48L3ByZT5cblx0XHRcdDwvZGl2PlxuXHRcdFx0PGJ1dHRvblxuXHRcdFx0XHQqbmdJZj1cIiFza2VsZXRvblwiXG5cdFx0XHRcdGNsYXNzPVwiYngtLXNuaXBwZXQtYnV0dG9uXCJcblx0XHRcdFx0W2F0dHIuYXJpYS1sYWJlbF09XCJ0cmFuc2xhdGlvbnMuQ09QWV9DT0RFXCJcblx0XHRcdFx0KGNsaWNrKT1cIm9uQ29weUJ1dHRvbkNsaWNrZWQoKVwiXG5cdFx0XHRcdHRhYmluZGV4PVwiMFwiPlxuXHRcdFx0XHQ8c3ZnIGlibUljb249XCJjb3B5XCIgc2l6ZT1cIjE2XCIgY2xhc3M9XCJieC0tc25pcHBldF9faWNvblwiPjwvc3ZnPlxuXHRcdFx0XHQ8bmctY29udGFpbmVyICpuZ1RlbXBsYXRlT3V0bGV0PVwiZmVlZGJhY2tUZW1wbGF0ZVwiPjwvbmctY29udGFpbmVyPlxuXHRcdFx0PC9idXR0b24+XG5cdFx0XHQ8YnV0dG9uXG5cdFx0XHRcdCpuZ0lmPVwic2hvdWxkU2hvd0V4cGFuZEJ1dHRvblwiXG5cdFx0XHRcdGNsYXNzPVwiYngtLWJ0biBieC0tYnRuLS1naG9zdCBieC0tYnRuLS1zbSBieC0tc25pcHBldC1idG4tLWV4cGFuZFwiXG5cdFx0XHRcdChjbGljayk9XCJ0b2dnbGVTbmlwcGV0RXhwYW5zaW9uKClcIlxuXHRcdFx0XHR0eXBlPVwiYnV0dG9uXCI+XG5cdFx0XHRcdDxzcGFuIGNsYXNzPVwiYngtLXNuaXBwZXQtYnRuLS10ZXh0XCI+e3tleHBhbmRlZCA/IHRyYW5zbGF0aW9ucy5TSE9XX0xFU1MgOiB0cmFuc2xhdGlvbnMuU0hPV19NT1JFfX08L3NwYW4+XG5cdFx0XHRcdDxzdmcgaWJtSWNvbj1cImNoZXZyb24tLWRvd25cIiBzaXplPVwiMTZcIiBjbGFzcz1cImJ4LS1pY29uLWNoZXZyb24tLWRvd25cIiBbYXJpYUxhYmVsXT1cInRyYW5zbGF0aW9ucy5TSE9XX01PUkVfSUNPTlwiPjwvc3ZnPlxuXHRcdFx0PC9idXR0b24+XG5cdFx0PC9uZy10ZW1wbGF0ZT5cblxuXHRcdDxuZy10ZW1wbGF0ZSAjY29kZVRlbXBsYXRlPlxuXHRcdFx0PGNvZGUgI2NvZGU+PG5nLWNvbnRlbnQ+PC9uZy1jb250ZW50PjwvY29kZT5cblx0XHQ8L25nLXRlbXBsYXRlPlxuXG5cdFx0PG5nLXRlbXBsYXRlICNmZWVkYmFja1RlbXBsYXRlPlxuXHRcdFx0PGRpdlxuXHRcdFx0Y2xhc3M9XCJieC0tYnRuLS1jb3B5X19mZWVkYmFja1wiXG5cdFx0XHRbbmdDbGFzc109XCJ7XG5cdFx0XHRcdCdieC0tYnRuLS1jb3B5X19mZWVkYmFjay0tZGlzcGxheWVkJzogc2hvd0ZlZWRiYWNrXG5cdFx0XHR9XCJcblx0XHRcdFthdHRyLmRhdGEtZmVlZGJhY2tdPVwiZmVlZGJhY2tUZXh0XCI+XG5cdFx0XHQ8L2Rpdj5cblx0XHQ8L25nLXRlbXBsYXRlPlxuXHRgXG59KVxuZXhwb3J0IGNsYXNzIENvZGVTbmlwcGV0IGltcGxlbWVudHMgQWZ0ZXJWaWV3SW5pdCB7XG5cdC8qKlxuXHQgKiBWYXJpYWJsZSB1c2VkIGZvciBjcmVhdGluZyB1bmlxdWUgaWRzIGZvciBjb2RlLXNuaXBwZXQgY29tcG9uZW50cy5cblx0ICovXG5cdHN0YXRpYyBjb2RlU25pcHBldENvdW50ID0gMDtcblxuXHQvKipcblx0ICogSXQgY2FuIGJlIGBcInNpbmdsZVwiYCwgYFwibXVsdGlcImAgb3IgYFwiaW5saW5lXCJgXG5cdCAqXG5cdCAqL1xuXHRASW5wdXQoKSBkaXNwbGF5OiBTbmlwcGV0VHlwZSA9IFNuaXBwZXRUeXBlLnNpbmdsZTtcblx0QElucHV0KCkgdHJhbnNsYXRpb25zID0gdGhpcy5pMThuLmdldCgpLkNPREVfU05JUFBFVDtcblxuXHQvKipcblx0ICogU2V0IHRvIGBcImxpZ2h0XCJgIHRvIGFwcGx5IHRoZSBsaWdodCBzdHlsZSBvbiB0aGUgY29kZSBzbmlwcGV0LlxuXHQgKi9cblx0QElucHV0KCkgdGhlbWU6IFwibGlnaHRcIiB8IFwiZGFya1wiID0gXCJkYXJrXCI7XG5cblx0LyoqXG5cdCAqIFRleHQgZGlzcGxheWVkIGluIHRoZSB0b29sdGlwIHdoZW4gdXNlciBjbGlja3MgYnV0dG9uIHRvIGNvcHkgY29kZS5cblx0ICpcblx0ICovXG5cdEBJbnB1dCgpIGZlZWRiYWNrVGV4dCA9IHRoaXMudHJhbnNsYXRpb25zLkNPUElFRDtcblxuXHQvKipcblx0ICogVGltZSBpbiBtaWxpc2Vjb25kcyB0byBrZWVwIHRoZSBmZWVkYmFjayB0b29sdGlwIGRpc3BsYXllZC5cblx0ICpcblx0ICovXG5cdEBJbnB1dCgpIGZlZWRiYWNrVGltZW91dCA9IDIwMDA7XG5cblx0QEhvc3RCaW5kaW5nKFwiY2xhc3MuYngtLXNuaXBwZXQtLWV4cGFuZFwiKSBASW5wdXQoKSBleHBhbmRlZCA9IGZhbHNlO1xuXHRASG9zdEJpbmRpbmcoXCJjbGFzcy5ieC0tc2tlbGV0b25cIikgQElucHV0KCkgc2tlbGV0b24gPSBmYWxzZTtcblxuXHRASG9zdEJpbmRpbmcoXCJjbGFzcy5ieC0tc25pcHBldFwiKSBzbmlwcGV0Q2xhc3MgPSB0cnVlO1xuXHRASG9zdEJpbmRpbmcoXCJjbGFzcy5ieC0tc25pcHBldC0tc2luZ2xlXCIpIGdldCBzbmlwcGV0U2luZ2xlQ2xhc3MoKSB7XG5cdFx0cmV0dXJuIHRoaXMuZGlzcGxheSA9PT0gU25pcHBldFR5cGUuc2luZ2xlO1xuXHR9XG5cdEBIb3N0QmluZGluZyhcImNsYXNzLmJ4LS1zbmlwcGV0LS1tdWx0aVwiKSBnZXQgc25pcHBldE11bHRpQ2xhc3MoKSB7XG5cdFx0cmV0dXJuIHRoaXMuZGlzcGxheSA9PT0gU25pcHBldFR5cGUubXVsdGk7XG5cdH1cblx0QEhvc3RCaW5kaW5nKFwiY2xhc3MuYngtLXNuaXBwZXQtLWlubGluZVwiKSBnZXQgc25pcHBldElubGluZUNsYXNzKCkge1xuXHRcdHJldHVybiB0aGlzLmRpc3BsYXkgPT09IFNuaXBwZXRUeXBlLmlubGluZTtcblx0fVxuXHRASG9zdEJpbmRpbmcoXCJjbGFzcy5ieC0tc25pcHBldC0tbGlnaHRcIikgZ2V0IHNuaXBwZXRJbmxpbmVMaWdodENsYXNzKCkge1xuXHRcdHJldHVybiB0aGlzLmRpc3BsYXkgPT09IFNuaXBwZXRUeXBlLmlubGluZSAmJiB0aGlzLnRoZW1lID09PSBcImxpZ2h0XCI7XG5cdH1cblx0QEhvc3RCaW5kaW5nKFwiY2xhc3MuYngtLWJ0bi0tY29weVwiKSBnZXQgYnRuQ29weUNsYXNzKCkge1xuXHRcdHJldHVybiB0aGlzLmRpc3BsYXkgPT09IFNuaXBwZXRUeXBlLmlubGluZTtcblx0fVxuXG5cdEBIb3N0QmluZGluZyhcInN0eWxlLmRpc3BsYXlcIikgZ2V0IGRpc3BsYXlTdHlsZSgpIHtcblx0XHRyZXR1cm4gdGhpcy5kaXNwbGF5ICE9PSBTbmlwcGV0VHlwZS5pbmxpbmUgPyBcImJsb2NrXCIgOiBudWxsO1xuXHR9XG5cdEBIb3N0QmluZGluZyhcImF0dHIudHlwZVwiKSBnZXQgYXR0clR5cGUoKSB7XG5cdFx0cmV0dXJuIHRoaXMuZGlzcGxheSA9PT0gU25pcHBldFR5cGUuaW5saW5lID8gXCJidXR0b25cIiA6IG51bGw7XG5cdH1cblxuXHQvLyBAdHMtaWdub3JlXG5cdEBWaWV3Q2hpbGQoXCJjb2RlXCIsIHsgc3RhdGljOiBmYWxzZSB9KSBjb2RlO1xuXG5cdGdldCBzaG91bGRTaG93RXhwYW5kQnV0dG9uKCkge1xuXHRcdC8vIENoZWNrcyBpZiBgaGFzRXhwYW5kYCBidXR0b24gaGFzIGJlZW4gaW5pdGlhbGl6ZWQgaW4gYEFmdGVyVmlld0luaXRgIGJlZm9yZSBkZXRlY3Rpbmcgd2hldGhlciBvciBub3QgdG9cblx0XHQvLyBzaG93IHRoZSBleHBhbmQgYnV0dG9uIHdoZW4gdGhlIGNvZGUgZGlzcGxheWVkIGluIHRoZSBjb21wb25lbnQgY2hhbmdlcyBkdXJpbmcgdGhlIGxpZmUgb2YgdGhlIGNvbXBvbmVudC5cblx0XHQvLyBUaGlzIGlzIHRvIGF2b2lkIHRoZSBgRXhwcmVzc2lvbkNoYW5nZWRBZnRlckl0SGFzQmVlbkNoZWNrZWRFcnJvcmAuXG5cdFx0aWYgKHRoaXMuaGFzRXhwYW5kQnV0dG9uID09PSBudWxsKSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5oYXNFeHBhbmRCdXR0b247XG5cdFx0fVxuXHRcdHJldHVybiB0aGlzLmNhbkV4cGFuZCgpO1xuXHR9XG5cblx0c2hvd0ZlZWRiYWNrID0gZmFsc2U7XG5cblx0aGFzRXhwYW5kQnV0dG9uID0gbnVsbDtcblxuXHQvKipcblx0ICogQ3JlYXRlcyBhbiBpbnN0YW5jZSBvZiBDb2RlU25pcHBldC5cblx0ICovXG5cdGNvbnN0cnVjdG9yKHByb3RlY3RlZCBpMThuOiBJMThuKSB7XG5cdFx0Q29kZVNuaXBwZXQuY29kZVNuaXBwZXRDb3VudCsrO1xuXHR9XG5cblx0dG9nZ2xlU25pcHBldEV4cGFuc2lvbigpIHtcblx0XHR0aGlzLmV4cGFuZGVkID0gIXRoaXMuZXhwYW5kZWQ7XG5cdH1cblxuXHQvKipcblx0ICogQ29waWVzIHRoZSBjb2RlIGZyb20gdGhlIGA8Y29kZT5gIGJsb2NrIHRvIGNsaXBib2FyZC5cblx0ICpcblx0ICovXG5cdGNvcHlDb2RlKCkge1xuXHRcdC8vIGNyZWF0ZSBpbnZpc2libGUsIHVuZWRpdGFibGUgdGV4dGFyZWEgd2l0aCBvdXIgY29kZSBpbiBpdFxuXHRcdGNvbnN0IHRleHRhcmVhID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInRleHRhcmVhXCIpO1xuXHRcdHRleHRhcmVhLnZhbHVlID0gdGhpcy5jb2RlLm5hdGl2ZUVsZW1lbnQuaW5uZXJUZXh0IHx8IHRoaXMuY29kZS5uYXRpdmVFbGVtZW50LnRleHRDb250ZW50O1xuXHRcdHRleHRhcmVhLnNldEF0dHJpYnV0ZShcInJlYWRvbmx5XCIsIFwiXCIpO1xuXHRcdHRleHRhcmVhLnN0eWxlLnBvc2l0aW9uID0gXCJhYnNvbHV0ZVwiO1xuXHRcdHRleHRhcmVhLnN0eWxlLnJpZ2h0ID0gXCItOTk5OTlweFwiO1xuXHRcdGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQodGV4dGFyZWEpO1xuXG5cdFx0Ly8gc2F2ZSB1c2VyIHNlbGVjdGlvblxuXHRcdGNvbnN0IHNlbGVjdGVkID0gZG9jdW1lbnQuZ2V0U2VsZWN0aW9uKCkucmFuZ2VDb3VudCA/IGRvY3VtZW50LmdldFNlbGVjdGlvbigpLmdldFJhbmdlQXQoMCkgOiBudWxsO1xuXG5cdFx0Ly8gY29weSB0byBjbGlwYm9hcmRcblx0XHR0ZXh0YXJlYS5zZWxlY3QoKTtcblx0XHRkb2N1bWVudC5leGVjQ29tbWFuZChcImNvcHlcIik7XG5cblx0XHQvLyByZW1vdmUgdGV4dGFyZWFcblx0XHRkb2N1bWVudC5ib2R5LnJlbW92ZUNoaWxkKHRleHRhcmVhKTtcblxuXHRcdC8vIHJlc3RvcmUgdXNlciBzZWxlY3Rpb25cblx0XHRpZiAoc2VsZWN0ZWQpIHtcblx0XHRcdGRvY3VtZW50LmdldFNlbGVjdGlvbigpLnJlbW92ZUFsbFJhbmdlcygpO1xuXHRcdFx0ZG9jdW1lbnQuZ2V0U2VsZWN0aW9uKCkuYWRkUmFuZ2Uoc2VsZWN0ZWQpO1xuXHRcdH1cblx0fVxuXG5cdG9uQ29weUJ1dHRvbkNsaWNrZWQoKSB7XG5cdFx0dGhpcy5jb3B5Q29kZSgpO1xuXG5cdFx0dGhpcy5zaG93RmVlZGJhY2sgPSB0cnVlO1xuXG5cdFx0c2V0VGltZW91dCgoKSA9PiB7XG5cdFx0XHR0aGlzLnNob3dGZWVkYmFjayA9IGZhbHNlO1xuXHRcdH0sIHRoaXMuZmVlZGJhY2tUaW1lb3V0KTtcblx0fVxuXG5cdG5nQWZ0ZXJWaWV3SW5pdCgpIHtcblx0XHRzZXRUaW1lb3V0KCgpID0+IHtcblx0XHRcdGlmICh0aGlzLmNhbkV4cGFuZCgpKSB7XG5cdFx0XHRcdHRoaXMuaGFzRXhwYW5kQnV0dG9uID0gdHJ1ZTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuaGFzRXhwYW5kQnV0dG9uID0gZmFsc2U7XG5cdFx0XHR9XG5cdFx0fSk7XG5cdH1cblxuXHQvKipcblx0ICogSW5saW5lIGNvZGUgc25pcHBldCBhY3RzIGFzIGJ1dHRvbiBhbmQgbWFrZXMgdGhlIHdob2xlIGNvbXBvbmVudCBjbGlja2FibGUuXG5cdCAqXG5cdCAqIFRoaXMgaGFuZGxlcyBjbGlja3MgaW4gdGhhdCBjYXNlLlxuXHQgKi9cblx0QEhvc3RMaXN0ZW5lcihcImNsaWNrXCIpXG5cdGhvc3RDbGljaygpIHtcblx0XHRpZiAodGhpcy5kaXNwbGF5ICE9PSBTbmlwcGV0VHlwZS5pbmxpbmUpIHtcblx0XHRcdHJldHVybjtcblx0XHR9XG5cblx0XHR0aGlzLm9uQ29weUJ1dHRvbkNsaWNrZWQoKTtcblx0fVxuXG5cdHByb3RlY3RlZCBjYW5FeHBhbmQoKSB7XG5cdFx0cmV0dXJuICh0aGlzLmNvZGUgJiYgdGhpcy5jb2RlLm5hdGl2ZUVsZW1lbnQuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkuaGVpZ2h0ID4gMjU1KSAmJiB0aGlzLmRpc3BsYXkgPT09IFwibXVsdGlcIjtcblx0fVxufVxuIl19